{"version":3,"sources":["../../src/controller/account.js"],"names":["config","db","api","post","req","res","register","username","body","email","password","err","account","send","authenticate","session","status","scope","get","logout","json","user"],"mappings":";;;;;;AAAA;;;;AACA;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AAEA;;;;kBAEe,gBAAkB;AAAA,QAAhBA,MAAgB,QAAhBA,MAAgB;AAAA,QAARC,EAAQ,QAARA,EAAQ;;AAC7B,QAAIC,MAAM,sBAAV;;AAEA;;AAEA;AACAA,QAAIC,IAAJ,CAAS,WAAT,EAAqB,UAACC,GAAD,EAAMC,GAAN,EAAc;AAC/B,0BAAQC,QAAR,CAAiB,sBAAY,EAACC,UAAUH,IAAII,IAAJ,CAASC,KAApB,EAAZ,CAAjB,EAAyDL,IAAII,IAAJ,CAASE,QAAlE,EAA4E,UAASC,GAAT,EAAcC,OAAd,EAAsB;AAC/F,gBAAGD,GAAH,EAAO;AACHN,oBAAIQ,IAAJ,CAASF,GAAT;AACH;AACD,+BAASG,YAAT,CACI,OADJ,EACY;AACJC,yBAAS;AADL,aADZ,EAIEX,GAJF,EAIMC,GAJN,EAIW,YAAK;AACZA,oBAAIW,MAAJ,CAAW,GAAX,EAAgBH,IAAhB,CAAqB,mCAArB;AACH,aAND;AAOF,SAXD;AAYH,KAbD;;AAgBA;AACAX,QAAIC,IAAJ,CAAS,QAAT,EAAkB,mBAASW,YAAT,CACd,OADc,EACL;AACLC,iBAAS,KADJ;AAELE,eAAO;AAFF,KADK,CAAlB;;AAQA;AACAf,QAAIgB,GAAJ,CAAQ,SAAR,gCAAgC,UAACd,GAAD,EAAKC,GAAL,EAAa;AAC1CA,YAAIc,MAAJ;AACAd,YAAIW,MAAJ,CAAW,GAAX,EAAgBH,IAAhB,CAAqB,0BAArB;AACF,KAHD;;AAKAX,QAAIgB,GAAJ,CAAQ,KAAR,gCAA4B,UAACd,GAAD,EAAKC,GAAL,EAAa;AACrCA,YAAIW,MAAJ,CAAW,GAAX,EAAgBI,IAAhB,CAAqBf,IAAIgB,IAAzB;AACH,KAFD;;AAKA,WAAOnB,GAAP;AACH,C","file":"account.js","sourcesContent":["import mongoose from 'mongoose';\nimport { Router } from 'express';\nimport Account from '../model/account';\nimport bodyParser from 'body-parser';\nimport passport from 'passport';\nimport config from '../config';\n\nimport { generateAccessToken, respond, authenticate } from '../middleware/authMiddleware';\n\nexport default ({config, db}) => {\n    let api = Router();\n    \n    // routes here\n    \n    // /v1/account/register\n    api.post('/register',(req, res) => {\n        Account.register(new Account({username: req.body.email}),req.body.password, function(err, account){\n           if(err){\n               res.send(err);\n           } \n           passport.authenticate(\n               'local',{\n                   session: false\n               }\n           )(req,res, () =>{\n               res.status(200).send('Successfully created new account.');\n           })\n        });\n    });\n    \n    \n    // /v1/account/login\n    api.post('/login',passport.authenticate(\n        'local', {\n            session: false,\n            scope: []\n        }),\n        generateAccessToken, respond\n    );\n    \n    // /v1/account/logout\n    api.get('/logout',authenticate, (req,res) => {\n       res.logout();\n       res.status(200).send('Successfully logged out.');\n    });\n    \n    api.get('/me',authenticate, (req,res) => {\n        res.status(200).json(res.user);\n    });\n    \n    \n    return api;\n}"]}